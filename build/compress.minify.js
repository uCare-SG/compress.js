(function(global,factory){if(typeof define==='function'&&define.amd){define(['module','exports','./core/base64.js','./core/converter.js','./core/file.js','./core/image.js','./core/photo.js','./core/rotate.js'],factory)}else if(typeof exports!=='undefined'){factory(module,exports,require('./core/base64.js'),require('./core/converter.js'),require('./core/file.js'),require('./core/image.js'),require('./core/photo.js'),require('./core/rotate.js'))}else{var mod={exports:{}};factory(mod,mod.exports,global.base64,global.converter,global.file,global.image,global.photo,global.rotate);global.compress=mod.exports}})(this,function(module,exports){'use strict';(function(n,o){if('function'==typeof define&&define.amd)define(['module','./core/base64.js','./core/converter.js','./core/file.js','./core/image.js','./core/photo.js','./core/rotate.js'],o);else if('undefined'!=typeof exports)o(module);else{var p={exports:{}};o(p,n.base64,n.converter,n.file,n.image,n.photo,n.rotate),n.compress=p.exports}})(void 0,function(n,o,p,q,r,s,t){'use strict';function u(F){return F&&F.__esModule?F:{default:F}}function v(F){if(Array.isArray(F)){for(var G=0,H=Array(F.length);G<F.length;G++)H[G]=F[G];return H}return Array.from(F)}function w(F,G){if(!(F instanceof G))throw new TypeError('Cannot call a class as a function')}var x=u(o),y=u(p),z=u(q),A=u(r),B=u(s),C=u(t),D=function(){function F(G,H){for(var I,J=0;J<H.length;J++)I=H[J],I.enumerable=I.enumerable||!1,I.configurable=!0,'value'in I&&(I.writable=!0),Object.defineProperty(G,I.key,I)}return function(G,H,I){return H&&F(G.prototype,H),I&&F(G,I),G}}(),E=function(){function F(){w(this,F)}return D(F,[{key:'attach',value:function(H,I){var J=this;return new Promise(function(K){var L=document.querySelector(H);L.setAttribute('accept','image/*'),L.addEventListener('change',function(M){var N=J.compress([].concat(v(M.target.files)),I);K(N)},!1)})}},{key:'compress',value:function(H,I){function J(M,N){var O=new B.default(N);return O.start=window.performance.now(),O.alt=M.name,O.ext=M.type,O.startSize=M.size,C.default.orientation(M).then(function(P){return O.orientation=P,z.default.load(M)}).then(K(O))}function K(M){return function(N){return A.default.load(N).then(function(O){if(M.startWidth=O.naturalWidth,M.startHeight=O.naturalHeight,M.resize){var P=A.default.resize(M.maxWidth,M.maxHeight)(O.naturalWidth,O.naturalHeight),Q=P.width,R=P.height;M.endWidth=Q,M.endHeight=R}else M.endWidth=O.naturalWidth,M.endHeight=O.naturalHeight;return y.default.imageToCanvas(M.endWidth,M.endHeight,M.orientation)(O)}).then(function(O){return M.iterations=1,M.base64prefix=x.default.prefix(M.ext),L(O,M.startSize,M.quality,M.size,M.minQuality,M.iterations)}).then(function(O){return M.finalSize=x.default.size(O),x.default.data(O)}).then(function(O){M.end=window.performance.now();var P=M.end-M.start;return{data:O,prefix:M.base64prefix,elapsedTimeInSeconds:P/1e3,alt:M.alt,initialSizeInMb:y.default.size(M.startSize).MB,endSizeInMb:y.default.size(M.finalSize).MB,ext:M.ext,quality:M.quality,endWidthInPx:M.endWidth,endHeightInPx:M.endHeight,initialWidthInPx:M.startWidth,initialHeightInPx:M.startHeight,sizeReducedInPercent:100*((M.startSize-M.finalSize)/M.startSize),iterations:M.iterations}})}}function L(M){var N=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,O=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,P=arguments[3],Q=arguments[5],R=y.default.canvasToBase64(M,N),S=x.default.size(R);return Q+=1,S>P?L(M,S,N-0.1,P,O,Q):N>O?L(M,S,N-0.1,P,O,Q):0.5>N?R:R}return Promise.all(H.map(function(M){return J(M,I)}))}}],[{key:'convertBase64ToFile',value:function(H,I){return y.default.base64ToFile(H,I)}}]),F}();n.exports=E})});
